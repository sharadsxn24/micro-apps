var vidContentInitialized=false;var vidAdsLoaded=false;var vidAdsManager=false;var vidVideoContent=null;var vidAdsRenderingSettings=new google.ima.AdsRenderingSettings();var vidVideoUrl="";var vidVideoUrlLow="";var vidAdsLoader=null;var vidAdsDisplayContainer=null;var destroyAdsTimer=null;var isAdLoaded=false;var elementWidth=0;var elementHeight=0;var videoStartTimer=null;var vidContainer=null;var vidSubContainer=null;var vidMainContainer=null;var vidSpinner=null;var vidPosterImage=null;var vidAdContainer=null;var newContainerId=null;var vidPlayArr=[];var curVidPlayId=null;var adPlayInterval=null;var iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;function initializeContent(){vidVideoContent.addEventListener("loadedmetadata",function(){vidContentInitialized=true;if(vidAdsLoaded){startAds()}});vidVideoContent.addEventListener("ended",onVideoComplete,false);vidVideoContent.load();vidVideoContent.addEventListener("play",function(){setInterval(function(){if(vidVideoContent.currentTime>0){hideLoader()}},500)},false)}function onAdsLoaded(){vidAdsLoaded=true;if(vidContentInitialized){startAds()}}function onVideoComplete(){var b=this.id.split("-");var a=b.pop();exitFullscreen(this.id);document.getElementById("vidSubContainer-"+a).style.display="inherit";document.getElementById("vidMainContainer-"+a).style.display="none";document.getElementById("vidAdContainer-"+a).style.top="0px";if(vidNameSpace){vidNameSpace.videoEndCallback()}}function exitFullscreen(a){console.log("current vidoe:"+a);if(document.exitFullscreen){document.getElementById(a).exitFullscreen()}else{if(document.webkitExitFullscreen){document.getElementById(a).webkitExitFullScreen()}}}window.addEventListener("resize",function(a){if(vidVideoContent){vidVideoContent.style.height=((3/4)*vidContainer.offsetWidth)+"px";vidContainer.style.height=((3/4)*vidContainer.offsetWidth)+"px";vidPosterImage.style.height=((3/4)*vidContainer.offsetWidth)+"px"}if(vidAdsManager){elementWidth=vidContainer.offsetWidth;elementHeight=vidContainer.offsetHeight;vidAdsManager.resize(elementWidth,elementHeight,google.ima.ViewMode.NORMAL)}});function pauseVideo(a){console.log("pause video id:"+a);if(vidAdsManager){vidAdsManager.destroy()}for(var c=0;c<vidPlayArr.length;c++){if(vidPlayArr[c]!=a){var b=document.getElementById("vidContentElement-"+vidPlayArr[c]);if(b.currentTime>0){b.pause()}else{document.getElementById("vidSubContainer-"+vidPlayArr[c]).style.display="inherit";document.getElementById("vidMainContainer-"+vidPlayArr[c]).style.display="none";document.getElementById("vidAdContainer-"+vidPlayArr[c]).style.top="0px"}}}}function pauseScrollVideo(a){console.log("pause scroll video id:"+a);if(vidAdsManager){vidAdsManager.destroy()}for(var c=0;c<vidPlayArr.length;c++){if(vidPlayArr[c]==a){var b=document.getElementById("vidContentElement-"+vidPlayArr[c]);if(b.currentTime>0){b.pause()}else{document.getElementById("vidSubContainer-"+vidPlayArr[c]).style.display="inherit";document.getElementById("vidMainContainer-"+vidPlayArr[c]).style.display="none";document.getElementById("vidAdContainer-"+vidPlayArr[c]).style.top="0px"}}}}function vidPlayVideo(c,a,h,e,g,d){if(vidPlayArr.length>0){if(vidPlayArr.indexOf(d)<0){vidPlayArr.push(d)}}else{vidPlayArr.push(d)}curVidPlayId=d;vidSpinner=document.getElementById("spinner-"+d);if(vidVideoContent){pauseVideo(curVidPlayId)}vidVideoContent=document.getElementById("vidContentElement-"+d);vidAdContainer=document.getElementById("vidAdContainer-"+d);vidContainer=document.getElementById("vidContainer-"+d);vidPosterImage=document.getElementById("posterImage-"+d);vidSubContainer=document.getElementById("vidSubContainer-"+d);vidMainContainer=document.getElementById("vidMainContainer-"+d);if(typeof(vidVideoContent)!="undefined"&&vidVideoContent!=null&&typeof(vidContainer)!="undefined"&&vidContainer!=null){vidVideoContent.style.height=((3/4)*vidContainer.offsetWidth)+"px";vidContainer.style.height=((3/4)*vidContainer.offsetWidth)+"px";elementWidth=vidContainer.offsetWidth;elementHeight=vidContainer.offsetHeight}vidVideoContent.addEventListener("play",function(m){if(m&&m.target.id){var l=m.target.id.split("-");var n=l.pop();for(var k=0;k<vidPlayArr.length;k++){if(vidPlayArr[k]!=n){var j=document.getElementById("vidContentElement-"+vidPlayArr[k]);if(j.currentTime>0){j.pause()}else{if(vidAdsManager){vidAdsManager.destroy()}document.getElementById("vidSubContainer-"+vidPlayArr[k]).style.display="inherit";document.getElementById("vidMainContainer-"+vidPlayArr[k]).style.display="none";document.getElementById("vidAdContainer-"+vidPlayArr[k]).style.top="0px"}}}}},false);showLoader();vidVideoContent.removeAttribute("controls");if(videoStartTimer){clearInterval(videoStartTimer)}if(vidAdsDisplayContainer){vidAdsDisplayContainer.destroy()}if(h){vidVideoUrlLow=h}else{vidVideoUrlLow=""}if(a){vidVideoUrl=a}else{vidVideoUrl=""}vidAdtagUrl=c;if(vidSubContainer.style.display=="none"){vidAdContainer.style.backgroundImage="url("+e+")"}vidAdContainer.style.top="0px";vidSubContainer.style.display="none";vidMainContainer.style.display="inherit";vidPosterImage.src=e;var b=1;if(typeof vidAdtagUrl==="undefined"||g==="undefined"){b=0}else{b=g}if(b==0){playVideoContent();setInterval(function(){hideLoader()},3000)}else{if(typeof vidAdtagUrl==="undefined"){playVideoContent();setInterval(function(){hideLoader()},3000)}else{vidAdsDisplayContainer=new google.ima.AdDisplayContainer(vidAdContainer);vidAdsLoader=new google.ima.AdsLoader(vidAdsDisplayContainer);vidAdsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,onAdsManagerLoaded,false);vidAdsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,onAdError,false);var f=new google.ima.AdsRequest();f.adTagUrl=vidAdtagUrl;vidAdsLoader.requestAds(f);vidAdsDisplayContainer.initialize();initializeContent()}}}function onAdsManagerLoaded(f){isAdLoaded=true;vidAdContainer.style.backgroundImage="url('')";vidAdsRenderingSettings.loadVideoTimeout=4000;vidAdsRenderingSettings.bitrate=50;vidAdsManager=f.getAdsManager(vidVideoContent,vidAdsRenderingSettings);vidAdsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,onAdError);vidAdsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,onContentPauseResumeRequested);vidAdsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,onContentResumeRequested);vidAdsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,onContentPauseResumeRequested);vidAdsManager.addEventListener(google.ima.AdEvent.Type.LOADED,onAdEvent);vidAdsManager.addEventListener(google.ima.AdEvent.Type.STARTED,onAdEvent);vidAdsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,onAdEvent);vidAdsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,onAdEvent);try{var b=window,j=document,h=j.documentElement,c=j.getElementsByTagName("body")[0],a=b.innerWidth||h.clientWidth||c.clientWidth,a=elementWidth;y=elementHeight;vidAdsManager.init(a,y,google.ima.ViewMode.NORMAL);vidAdsManager.start()}catch(i){playVideoContent()}}function onAdEvent(a){var b=a.getAd();switch(a.type){case google.ima.AdEvent.Type.LOADED:break;case google.ima.AdEvent.Type.STARTED:var c=a.getAd().getDuration();if(c>0){adPlayInterval=setInterval(function(){if(c-vidAdsManager.getRemainingTime()>=1){clearInterval(adPlayInterval);if(vidNameSpace){vidNameSpace.adStartCallback()}}},1000)}setTimeout(function(){hideLoader()},1000);break;case google.ima.AdEvent.Type.SKIPPED:if(vidNameSpace){vidNameSpace.adSkipCallback()}showLoader();vidAdsManager.destroy();playVideoContent();break;case google.ima.AdEvent.Type.COMPLETE:if(vidNameSpace){vidNameSpace.adCompleteCallback()}showLoader();vidAdsManager.destroy();playVideoContent();break;defaut:showLoader();playVideoContent();break}}function onContentResumeRequested(){showLoader();vidAdsManager.destroy();playVideoContent()}function onContentPauseResumeRequested(){}function playVideoContent(){clearInterval(adPlayInterval);vidVideoContent.setAttribute("controls","controls");vidVideoContent.src=vidVideoUrl;vidVideoContent.load();vidVideoContent.play();videoStartTimer=setInterval(function(){if(vidVideoContent.currentTime>=1){if(vidNameSpace){vidNameSpace.videoStartCallback()}clearInterval(videoStartTimer)}},2000);vidAdContainer.style.top="-30000px"}function switchLowBitrate(){if(vidVideoUrlLow){vidVideoUrl=vidVideoUrlLow}}function onAdError(a){console.log(a.getError());if(a.getError().getType()==google.ima.AdError.Type.AD_PLAY){console.log("ad Play eror");switchLowBitrate()}showLoader();playVideoContent();if(vidAdsManager){vidAdsManager.destroy()}}function showLoader(){if(!iOS){vidSpinner.style.display="inherit"}}function hideLoader(){vidSpinner.style.display="none"};